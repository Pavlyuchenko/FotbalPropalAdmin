<script>
	import Nadpis from "../Nadpis.svelte";
	import { onMount } from "svelte";
	import { navigate } from "svelte-routing";
	import { cookie, prezdivka } from "../../store";

	onMount(() => {
		getClanky();
	});

	async function getClanky() {
		const res = await fetch(
			"https://velkadomu.pythonanywhere.com/sekundarni-clanky",
			{
				method: "POST",
				headers: {
					"content-type": "application/json",
				},
				body: JSON.stringify({
					cookie: $cookie,
					prezdivka: $prezdivka,
				}),
			}
		);
		const json = await res.json();
		clanky = json.clanky;
		/* for (let i = 0; i <= clanky.length; i++) {
			chosen = chosen + 1;
		} */
		ids = json.ids;
		chosen = ids.length;
	}

	let clanky = [""];
	let ids = [0];
	let chosen;

	function setHlavniClanek() {
		fetch("https://velkadomu.pythonanywhere.com/set-sekundarni-clanek", {
			method: "POST",
			headers: {
				"content-type": "application/json",
			},
			body: JSON.stringify({
				ids: ids,
				cookie: $cookie,
				prezdivka: $prezdivka,
			}),
		})
			.then(() => {
				navigate("/");
			})
			.catch((err) => {
				console.log(err);
			});
	}
</script>

<div id="main">
	<div id="wrapper">
		<Nadpis text="Sekundární články" />
		<section>
			{#each clanky as clanek}
				<div
					id={ids.includes(clanek.id) && "chosen"}
					class="border"
					on:click={() => {
						if (ids.includes(clanek.id)) {
							ids.splice(ids.indexOf(clanek.id), 1);
							ids = ids;
							chosen--;
						} else if (chosen < 3) {
							ids.push(clanek.id);
							ids = ids;
							chosen++;
						}
					}}
				>
					<div id="green">
						<img
							src={"https://ik.imagekit.io/velkadomu/tr:h-260,w-420" +
								clanek.obrazek}
							alt=""
						/>
						<div class="checkmark" />
					</div>
					<h2>{clanek.titulek}</h2>
				</div>
			{/each}
		</section>
	</div>
	<div id="button" on:click={chosen == 3 && setHlavniClanek}>Uložit</div>
</div>

<style>
	#main {
		padding: 0px calc((100% - 85rem) / 2) 80px calc((100% - 85rem) / 2);
	}
	#wrapper {
		margin-top: 80px;
	}
	section {
		margin-top: 50px;
		display: flex;
		justify-content: space-between;
		flex-wrap: wrap;
	}
	section div {
		width: 30%;
		height: 100%;

		position: relative;

		cursor: pointer;
	}
	section div img {
		border: 10px solid #ffffff;
	}
	h2 {
		margin-top: 5px;
		margin-bottom: 40px;
	}
	img {
		width: 100%;
	}
	#chosen img {
		border: 10px solid #20e500;
	}
	section #green {
		width: 100%;
		height: 100%;
	}
	#chosen #green::before {
		content: "";
		display: block;
		position: absolute;
		margin: auto;
		top: 0;
		left: 0;
		bottom: 0;
		right: 0;

		width: 100px;
		height: 100px;
		border-radius: 50%;
		background-color: #20e500;
	}

	#chosen .checkmark {
		display: inline-block;
	}

	.checkmark {
		display: none;
		position: absolute;
		width: 15px;
		height: 30px;
		left: calc(50% - 4px);
		top: calc(50% - 7px);
		transform: translateY(-50%) translateX(-50%);
	}
	.checkmark:after {
		content: "";
		display: block;
		width: 15px;
		height: 30px;
		border: solid #ffffff;
		border-width: 0 10px 10px 0;
		transform: rotate(45deg);
	}
	#button {
		position: fixed;

		bottom: 20px;
		left: calc(50% - 50px);

		width: 100px;
		height: 40px;

		background-color: #20e500;
		text-align: center;
		color: #ffffff;
		font-weight: 700;
		font-size: 24px;
		line-height: 40px;

		cursor: pointer;
	}
</style>
